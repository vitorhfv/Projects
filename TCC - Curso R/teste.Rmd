---
title: "Um passeio pela história do cinema com o IMDB"
author: "Vitor H. F. Vieira"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
    code_folding: hide
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(echo = TRUE)
```

------------------------------------------------------------------------

# O que é o IMDB?

O IMDB é uma base de dados on-line que reúne informações a respeito de grandes indústrias de entretenimento do mundo, em particular a cinematográfica, que será nosso objeto de estudo neste trabalho. Fundado em 1990, mantém-se até hoje como fonte confiável para obtenção de informações técnicas a respeito da Sétima Arte. Vamos desbravá-lo?

Para tal, carreguemos a base de dados do IMDB mais ampla e o pacote `tidyverse`:

```{r}
library (tidyverse)
imdb_completa <- basesCursoR::pegar_base("imdb_completa")
```

Neste momento, tentemos explorar a base de dados a partir de algumas perguntas. Qual é o mês do ano com mais estreias cinematográficas, segundo o IMDB? E o dia do ano?

Para responder a essas perguntas, escolhemos a variável de interesse `data_lançamento`, transformando-a em data, e excluímos os valores nulos desta coluna, para que possamos dividi-la em três .

```{r}
imdb_completa2 <- imdb_completa |>
  select(titulo, data_lancamento) |>
  mutate(data_lancamento = as.Date(data_lancamento)) |>
  drop_na (data_lancamento)


# Divide-se em três a coluna relativa à data.


imdb_data <- imdb_completa2 |>
  mutate (ano = lubridate::year(data_lancamento),
          mes = lubridate::month(data_lancamento),
          dia = lubridate::day(data_lancamento))
```

É possível responder às perguntas iniciais de duas formas: uma mais simples e outra mais demorada. Vamos a elas?

A partir de uma função sobre a qual  calculamos a moda, o termo mais repetido dentro de um vetor, temos:

```{r echo=TRUE}
# A função abaixo busca o termo mais repetido dentro uma coluna. 

mais_repetido <- function(x) {
  uniqx <- unique(x)
  uniqx[which.max(tabulate(match(x, uniqx)))]
}

mais_repetido(imdb_data$mes)
```
Assim, o mês do ano com o maior número de filmes lançados dentre todos os filmes cuja data de estreia é conhecida é o décimo mês do ano, o popular outubro!

Mas, quantos filmes, dentre todos os `r formatC(nrow(imdb_data))` cuja data de lançamento é conhecida, foram lançados no mês de outubro, segundo o IMDB?
```{r}
filmes_lancados_total<- function (data, by, ...) {
  data %>%
    group_by({{by}}) |>
    mutate(filmes=n()) |>
    ungroup()
}

imdb_meses <- imdb_data |>
  filmes_lancados_total (mes) |>
  distinct(mes, filmes) |>
  arrange(desc(filmes)) |>
  mutate (mes = lubridate::month(mes, label = TRUE),
          filmes_lancados = filmes) |>
  select(mes, filmes_lancados)
```

|mês | filmes lancados|
|:---|---------------:|
|out |            8734|
|set |            7924|
|mar |            7435|
|nov |            7094|
|abr |            7078|
|dez |            6618|

Assim, confirmamos que o mês em que mais houve estreias cinematográficas, segundo o IMDB, foi outubro, seguido pelo meses de setembro, março e novembro, apontando uma tendência de lançamentos na segunda metade do ano. Agora vamos além: qual é o dia do ano onde mais há concentração de estreias no cinema?


O seu relatório deve (ao menos) responder as seguintes perguntas:

1.  Qual o mês do ano com o maior númedo de filmes? E o dia do ano?

2.  Qual o top 5 países com mais filmes na base?

3.  Liste todas as moedas que aparecem nas colunas `orcamento` e `receita` da base `imdb_completa`.

4.  Considerando apenas orçamentos e receitas em dólar (\$), qual o gênero com maior lucro? E com maior nota média?

5.  Dentre os filmes na base `imdb_completa`, escolha o seu favorito. Então faça os itens a seguir:


# 2. E agora?

a)  Quem dirigiu o filme? Faça uma ficha dessa pessoa: idade (hoje em dia ou data de falecimento), onde nasceu, quantos filmes já dirigiu, qual o lucro médio dos filmes que dirigiu (considerando apenas valores em dólar) e outras informações que achar interessante (base `imdb_pessoas`).

b)  Qual a posição desse filme no ranking de notas do IMDB? E no ranking de lucro (considerando apenas valores em dólar)?

c)  Em que dia esse filme foi lançado? E dia da semana? Algum outro filme foi lançado no mesmo dia? Quantos anos você tinha nesse dia?

d)  Faça um gráfico representando a distribuição da nota atribuída a esse filme por idade (base `imdb_avaliacoes`).

```{r}
remotes::install_github("curso-r/basesCursoR")
imdb <- basesCursoR::pegar_base("imdb_completa")
imdb_pessoas <- basesCursoR::pegar_base("imdb_pessoas")
imdb_avaliacoes <- basesCursoR::pegar_base("imdb_avaliacoes")
```

# Terceiro teste

Temos de colocar um código para testar de forma satisfatória a ferramenta

```{r}
lucro_real <- readRDS('data\\rds\\lucro_real.rds')
lucro_real |>
  head(10)
```

aa
